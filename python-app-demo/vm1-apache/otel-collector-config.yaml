# otel-collector-config.yaml — OTel Collector sidecar on pyapp1
#
# Receives gRPC spans from the Apache OTel module on localhost:4317
# and exports them via OTLP/HTTP to OCI APM.
#
# Replace these placeholders before deploying:
#   <APM_DOMAIN>            → APM domain prefix (e.g., abcdef123456)
#   <REGION>                → OCI region (e.g., eu-frankfurt-1)
#   <YOUR_PRIVATE_DATA_KEY> → APM private data key
#
# Find these values:
#   OCI Console → Observability & Management → APM → your domain → Data Keys
#
# Usage:
#   otelcol --config /opt/otel-collector/otel-collector-config.yaml

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: "0.0.0.0:4317"

processors:
  batch:
    timeout: 5s
    send_batch_size: 512

exporters:
  otlphttp:
    headers:
      Authorization: "dataKey <YOUR_PRIVATE_DATA_KEY>"
    # OCI APM uses a non-standard OTLP path — traces_endpoint overrides the default /v1/traces
    traces_endpoint: "https://<APM_DOMAIN>.apm-agt.<REGION>.oci.oraclecloud.com/20200101/opentelemetry/v1/traces"

service:
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlphttp]
