# /etc/httpd/conf.d/opentelemetry_module.conf
# ---------------------------------------------------------------------------
# OpenTelemetry Apache module configuration for StayEasy demo.
#
# This makes Apache appear as "stayeasy-webserver" in OCI APM traces.
# The module automatically injects W3C traceparent headers on ProxyPass.
#
# Replace <APM_ENDPOINT> with your OCI APM OTLP endpoint.
# ---------------------------------------------------------------------------

# --- Load shared libraries (order matters) ---
LoadFile /opt/opentelemetry-webserver-sdk/sdk_lib/lib/libopentelemetry_common.so
LoadFile /opt/opentelemetry-webserver-sdk/sdk_lib/lib/libopentelemetry_resources.so
LoadFile /opt/opentelemetry-webserver-sdk/sdk_lib/lib/libopentelemetry_trace.so
LoadFile /opt/opentelemetry-webserver-sdk/sdk_lib/lib/libopentelemetry_otlp_recordable.so
LoadFile /opt/opentelemetry-webserver-sdk/sdk_lib/lib/libopentelemetry_exporter_otlp_grpc.so
LoadModule otel_apache_module /opt/opentelemetry-webserver-sdk/WebServerModule/Apache/libmod_apache_otel.so

# --- Enable the module ---
ApacheModuleEnabled ON

# --- Service identity (shows in APM topology) ---
ApacheModuleServiceName stayeasy-webserver
ApacheModuleServiceNamespace StayEasy
ApacheModuleServiceInstanceId pyapp1

# --- OTLP exporter ---
# The module uses gRPC by default. Options:
#   Option A: Direct to OCI APM (if gRPC endpoint supported)
#     ApacheModuleOtelExporterEndpoint https://<domain>.apm-agt.<region>.oci.oraclecloud.com:443
#   Option B: Via local OTel Collector (receives gRPC, exports HTTP to APM)
#     ApacheModuleOtelExporterEndpoint localhost:4317
#
# Set your endpoint below:
ApacheModuleOtelExporterEndpoint localhost:4317

# --- Backend resolution (auto-detects ProxyPass targets) ---
ApacheModuleResolveBackends ON

# --- Span limits ---
ApacheModuleOtelMaxQueueSize 2048
ApacheModuleOtelScheduledDelayMillis 3000

# --- Logging (set to ON for debugging, OFF for production) ---
ApacheModuleTraceAsError OFF
