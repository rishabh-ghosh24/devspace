# /etc/httpd/conf.d/quart-demo.conf
# ---------------------------------------------------------------------------
# Apache reverse-proxy config for the Retail Quart Demo (VM1)
#
# Required modules (enabled by default on OEL 9 httpd):
#   mod_proxy, mod_proxy_http, mod_headers
#
# Replace VM2_PRIVATE_IP with the actual private IP of VM2.
# ---------------------------------------------------------------------------

<VirtualHost *:80>
    ServerName _default_

    # Preserve the original Host header so Quart sees the right hostname
    ProxyPreserveHost On

    # Forward W3C Trace Context headers downstream so traces stitch correctly
    RequestHeader set traceparent "%{HTTP_TRACEPARENT}e" env=HTTP_TRACEPARENT
    RequestHeader set tracestate  "%{HTTP_TRACESTATE}e"  env=HTTP_TRACESTATE

    # Proxy all traffic to the Quart app on VM2
    ProxyPass        "/" "http://VM2_PRIVATE_IP:8080/"
    ProxyPassReverse "/" "http://VM2_PRIVATE_IP:8080/"

    # Basic access log for demo troubleshooting
    ErrorLog  /var/log/httpd/quart-demo-error.log
    CustomLog /var/log/httpd/quart-demo-access.log combined
</VirtualHost>
