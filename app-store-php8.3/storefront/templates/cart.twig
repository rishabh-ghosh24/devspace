{% extends "base.twig" %}

{% block title %}Cart{% endblock %}

{% block content %}
<h2>Your Cart</h2>
{% if cart.items %}
<table class="table">
    <thead>
        <tr>
            <th>Product</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Total</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for item in cart.items %}
        <tr>
            <td>{{ item.name }}</td>
            <td>{{ item.qty }}</td>
            <td>${{ (item.price / 100)|number_format(2) }}</td>
            <td>${{ ((item.qty * item.price) / 100)|number_format(2) }}</td>
            <td>
                <button class="btn btn-sm btn-danger remove-item" data-product-id="{{ item.product_id }}">Remove</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <th colspan="3">Total</th>
            <th>${{ (cart.totals.amount / 100)|number_format(2) }}</th>
            <th></th>
        </tr>
    </tfoot>
</table>
<a href="/checkout" class="btn btn-success">Checkout</a>
{% else %}
<p>Your cart is empty.</p>
<a href="/products" class="btn btn-primary">Browse Products</a>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            // For simplicity, set qty to 0 to remove
            fetch('/cart', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ product_id: parseInt(productId), qty: 0 })
            })
            .then(response => response.json())
            .then(data => {
                location.reload();
            })
            .catch(error => console.error('Error:', error));
        });
    });
});
</script>
{% endblock %}
